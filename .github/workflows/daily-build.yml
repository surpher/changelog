on: push

name: Daily build changelog

jobs:
  generate_changelog:
    name: "ðŸ§ª Generate changelog"
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v1

      - name: "Prepare changelog file"
        run: |
          $(git log --first-parent main --merges --pretty=format:"%b%n" $(git tag --list 'build-number-*' --sort=v:refname | head -1)..HEAD ) >> build/Artifacts/changelog.txt
          cat build/Artifacts/changelog.txt

      - name: "Archive changelog"
        uses: actions/upload-artifact@v2
        if: always()
        with:
          name: changelog.txt
          path: build/Artifacts
  
  read_file:
    name: Fetching Artifacts
    runs-on: ubuntu-latest
    needs: [generate_changelog]

    steps:
      - uses: actions/checkout@v1
      - name: "Download changelog"
        uses: actions/download-artifact@v2
        with:
          name: changelog.txt
          path: build/Artifacts
      
      - name: "Read the changes"
        id: read_changelog
        run: |
          cat build/Artifacts/changelog.txt
        